I am in the process of rebuilding my home lab using Talos Linux and at least 3 Raspberry Pi 5 16GB with 1TB NVME SSD's.  Right now, I run a few separate machines on my network that handle different things. I like NixOS for the machines because I am able to manage and provision my whole network with a version controlled git repo. For this reason, Talos caught my eye.

Right now, I run NixOS on a ZimaBlade, Home Assistant OS on a dedicated Raspberry Pi 5 16GB, two NVidia Shields running Android OS which I use for Kodi, a few NixOS x86 machines, and a Synology NAS which handles all of the files for each of these machines (where possible).  I have a 19" rack enclosure for the Pi that currently only contains only one of the 4 Raspberry Pi 5's which runs Home Assistant OS. Each slot comes with a dedicated NVME hat that I am definitwly going to utilize.   

The plan is to slowly transition my Home Assistant OS (and indeed any service or OS I plan to run continuously on my network) to an image running on Kubernetes by way of a highly available Talos cluster.  Using a modular, low energy setup like this, I could set-and-forget my Talos cluster and add and remove services at will. This would make upgrades super simple while also making it possible to provision my entire network using this code as infrastructure approach.  

As I make progress on getting Talos setup, this blog is a place for me to distill the entire, PROPER build procedure for those following along with their own home labs.  I haven't shared my NixOS setup because it would create some security issues for me until I can properly get SOPS-NIX working properly.

Right now, I am still at the point where I am still soaking in info, prodding and poking, and prototyping. Using the power of Nix flakes, I plan to eventually have the capability to get a whole cluster up and running in seconds using one command to flash and provision a whole custom Pi5 Image with an NVME drive via PXEboot.  

I am also looking into replacing my entire Synology NAS with a Rook CEPH storage cluster but I also hear of "Longhorn" which also does distributed storage.  That won't happen for a while, though. 90 TB is no joke to move around.

The other reason I want to learn all of this is for the purposes of SAAS. I am in the process of creating a full open source retail infrastructure for enterprise use written in Nix, with a Haskell Servant back end, and Purescript front end.  I had planned to do this with a simple x86 machine runing a custon NixOS. However, it seems like multiple compute modules in a cluster would be vastly easier to manage while also being lower power, higher security, high availability, scaleable, self-healing, and perhaps even more capable.  I could run my app in images on a cluster which would allow all kinds of extra capability.  I am still researching how I could deliver the binaries for this app with this new infrastructure but even if it meant that I'd have to run the app as a (lightweight) NixOS VM on Talos seems really powerful.  The decentralized nature of K8S as well as the minimalist nature of Talos promises to make no-downtime upgrades relatively painless.  

